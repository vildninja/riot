<!DOCTYPE html>
<html>
	<head>
		<meta charset=utf-8>
		<title>My first three.js app</title>
		<style>
			body { margin: 0; }
			canvas { width: 100%; height: 100% }
		</style>
	</head>
	<body>
		<script src="three.min.js"></script>
		<script src="js/loaders/OBJLoader.js"></script>
		<script src="world.js"></script>
		<script>

			var width = window.innerWidth;
			var height = window.innerHeight - 100;

			// Our Javascript will go here.
			var scene = new THREE.Scene();
			var camera = new THREE.PerspectiveCamera( 45, width / height, 0.1, 1000 );

			camera.position.z = 10;

			var renderer = new THREE.WebGLRenderer();
			renderer.setSize( width, height );
			document.body.appendChild( renderer.domElement );

			var geometry = new THREE.BoxGeometry( 0.1, 0.1, 0.1 );
			var material = new THREE.MeshBasicMaterial( { color: 0x00ff00 } );
			var cube = new THREE.Mesh( geometry, material );
			scene.add( cube );


			var house;

			var manager = new THREE.LoadingManager();


			manager.onProgress = function ( item, loaded, total ) {

				console.log( item, loaded, total );

			};

			var filesLoaded = false;
			var gameStarted = false;

			manager.onLoad = function ( ) {

				console.log( 'Loading complete!');

				var wall = new Entity(scene, 1, "wall",  new THREE.Vector3( 0, 0, 0 ));
				var peop = new Entity(scene, 2, "peop",  new THREE.Vector3( 1, 1, 0 ));
				//new Entity(scene, 1, "box",  new THREE.Vector3( 0, 50, 0 ));

				filesLoaded = true;

			};

			LoadAll(manager);



			var animate = function () {
				requestAnimationFrame( animate );


				renderer.render( scene, camera );
				
				if (filesLoaded)
				{
					if (!gameStarted)
					{
						entities[1].Goto(new THREE.Vector2(2, 2));
						StartGame(0);
						gameStarted = true;
					}

					Update();
					document.getElementById("infotext").innerHTML = tick;
				}


				if (house != undefined)
				{
					house.rotation.x += 0.1;
					house.rotation.y += 0.1;
				}
			}
			animate();

			var socket = new WebSocket("ws://pew.dk");
			// Show a connected message when the WebSocket is opened.
			socket.onopen = function(event) {
				console.log('Connected to: ' + event.currentTarget.url);
			};
			// Handle any errors that occur.
			socket.onerror = function(error) {
				console.log('WebSocket Error: ' + error);
			};

			function Move(e, x, y)
			{
				PushTickEvent(tick + 2, new TickEvent(e, new THREE.Vector2(x, y)));
			}

		</script>
		<p id="infotext">Text</p>
		<p>
			<a href="#" onclick="Move(2, -1, 0)">left</a>
			<a href="#" onclick="Move(2, 1, 0)">right</a>
			<a href="#" onclick="Move(2, 0, 1)">up</a>
			<a href="#" onclick="Move(2, 0, -1)">down</a>
		</p>
	</body>
</html>